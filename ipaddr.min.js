(function(){var r,t,e,n,i,o,s,a,d;t={},a=this,"undefined"!=typeof module&&null!==module&&module.exports?module.exports=t:a.ipaddr=t,s=function(r,t,e,n){var i,o;if(r.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");for(i=0;n>0;){if((o=e-n)<0&&(o=0),r[i]>>o!=t[i]>>o)return!1;n-=e,i+=1}return!0},t.subnetMatch=function(r,t,e){var n,i,o,s,a;null==e&&(e="unicast");for(o in t)for(!(s=t[o])[0]||s[0]instanceof Array||(s=[s]),n=0,i=s.length;n<i;n++)if(a=s[n],r.kind()===a[0].kind()&&r.match.apply(r,a))return o;return e},t.IPv4=function(){function r(r){var t,e,n;if(4!==r.length)throw new Error("ipaddr: ipv4 octet count should be 4");for(t=0,e=r.length;t<e;t++)if(!(0<=(n=r[t])&&n<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=r}return r.prototype.kind=function(){return"ipv4"},r.prototype.toString=function(){return this.octets.join(".")},r.prototype.toNormalizedString=function(){return this.toString()},r.prototype.toByteArray=function(){return this.octets.slice(0)},r.prototype.match=function(r,t){var e;if(void 0===t&&(r=(e=r)[0],t=e[1]),"ipv4"!==r.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return s(this.octets,r.octets,8,t)},r.prototype.SpecialRanges={unspecified:[[new r([0,0,0,0]),8]],broadcast:[[new r([255,255,255,255]),32]],multicast:[[new r([224,0,0,0]),4]],linkLocal:[[new r([169,254,0,0]),16]],loopback:[[new r([127,0,0,0]),8]],carrierGradeNat:[[new r([100,64,0,0]),10]],private:[[new r([10,0,0,0]),8],[new r([172,16,0,0]),12],[new r([192,168,0,0]),16]],reserved:[[new r([192,0,0,0]),24],[new r([192,0,2,0]),24],[new r([192,88,99,0]),24],[new r([198,51,100,0]),24],[new r([203,0,113,0]),24],[new r([240,0,0,0]),4]]},r.prototype.range=function(){return t.subnetMatch(this,this.SpecialRanges)},r.prototype.toIPv4MappedAddress=function(){return t.IPv6.parse("::ffff:"+this.toString())},r.prototype.prefixLengthFromSubnetMask=function(){var r,t,e,n,i,o,s;for(s={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},r=0,i=!1,t=e=3;e>=0;t=e+=-1){if(!((n=this.octets[t])in s))return null;if(o=s[n],i&&0!==o)return null;8!==o&&(i=!0),r+=o}return 32-r},r}(),e="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp("^"+e+"\\."+e+"\\."+e+"\\."+e+"$","i"),longValue:new RegExp("^"+e+"$","i")},t.IPv4.parser=function(r){var t,e,i,o,s;if(e=function(r){return"0"===r[0]&&"x"!==r[1]?parseInt(r,8):parseInt(r)},t=r.match(n.fourOctet))return function(){var r,n,o,s;for(s=[],r=0,n=(o=t.slice(1,6)).length;r<n;r++)i=o[r],s.push(e(i));return s}();if(t=r.match(n.longValue)){if((s=e(t[1]))>4294967295||s<0)throw new Error("ipaddr: address outside defined range");return function(){var r,t;for(t=[],o=r=0;r<=24;o=r+=8)t.push(s>>o&255);return t}().reverse()}return null},t.IPv6=function(){function r(r,t){var e,n,i,o,s,a;if(16===r.length)for(this.parts=[],e=n=0;n<=14;e=n+=2)this.parts.push(r[e]<<8|r[e+1]);else{if(8!==r.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=r}for(i=0,o=(a=this.parts).length;i<o;i++)if(!(0<=(s=a[i])&&s<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return r.prototype.kind=function(){return"ipv6"},r.prototype.toString=function(){var r,t,e,n,i,o,s,a,d;for(a=function(){var r,t,e,n;for(n=[],r=0,t=(e=this.parts).length;r<t;r++)i=e[r],n.push(i.toString(16));return n}.call(this),t=[],o=function(r){return t.push(r)},s=0,e=0,n=a.length;e<n;e++)switch(i=a[e],s){case 0:o("0"===i?"":i),s=1;break;case 1:"0"===i?s=2:o(i);break;case 2:"0"!==i&&(o(""),o(i),s=3);break;case 3:o(i)}return 2===s&&(o(""),o("")),r=t.join(":"),d="",this.zoneId&&(d="%"+this.zoneId),r+d},r.prototype.toByteArray=function(){var r,t,e,n,i;for(r=[],t=0,e=(i=this.parts).length;t<e;t++)n=i[t],r.push(n>>8),r.push(255&n);return r},r.prototype.toNormalizedString=function(){var r,t,e;return r=function(){var r,e,n,i;for(i=[],r=0,e=(n=this.parts).length;r<e;r++)t=n[r],i.push(t.toString(16));return i}.call(this).join(":"),e="",this.zoneId&&(e="%"+this.zoneId),r+e},r.prototype.match=function(r,t){var e;if(void 0===t&&(r=(e=r)[0],t=e[1]),"ipv6"!==r.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return s(this.parts,r.parts,16,t)},r.prototype.SpecialRanges={unspecified:[new r([0,0,0,0,0,0,0,0]),128],linkLocal:[new r([65152,0,0,0,0,0,0,0]),10],multicast:[new r([65280,0,0,0,0,0,0,0]),8],loopback:[new r([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new r([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new r([0,0,0,0,0,65535,0,0]),96],rfc6145:[new r([0,0,0,0,65535,0,0,0]),96],rfc6052:[new r([100,65435,0,0,0,0,0,0]),96],"6to4":[new r([8194,0,0,0,0,0,0,0]),16],teredo:[new r([8193,0,0,0,0,0,0,0]),32],reserved:[[new r([8193,3512,0,0,0,0,0,0]),32]]},r.prototype.range=function(){return t.subnetMatch(this,this.SpecialRanges)},r.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},r.prototype.toIPv4Address=function(){var r,e,n;if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");return n=this.parts.slice(-2),r=n[0],e=n[1],new t.IPv4([r>>8,255&r,e>>8,255&e])},r.prototype.prefixLengthFromSubnetMask=function(){var r,t,e,n,i,o,s;for(s={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},r=0,i=!1,t=e=7;e>=0;t=e+=-1){if(!((n=this.parts[t])in s))return null;if(o=s[n],i&&0!==o)return null;16!==o&&(i=!0),r+=o}return 128-r},r}(),i="(?:[0-9a-f]+::?)+",d="%[0-9a-z]{1,}",o={zoneIndex:new RegExp(d,"i"),native:new RegExp("^(::)?("+i+")?([0-9a-f]+)?(::)?("+d+")?$","i"),transitional:new RegExp("^((?:"+i+")|(?:::)(?:"+i+")?)"+e+"\\."+e+"\\."+e+"\\."+e+"(%[0-9a-z]{1,})?$","i")},r=function(r,t){var e,n,i,o,s,a;if(r.indexOf("::")!==r.lastIndexOf("::"))return null;for((a=(r.match(d)||[])[0])&&(a=a.substring(1),r=r.replace(/%.+$/,"")),e=0,n=-1;(n=r.indexOf(":",n+1))>=0;)e++;if("::"===r.substr(0,2)&&e--,"::"===r.substr(-2,2)&&e--,e>t)return null;for(s=t-e,o=":";s--;)o+="0:";return":"===(r=r.replace("::",o))[0]&&(r=r.slice(1)),":"===r[r.length-1]&&(r=r.slice(0,-1)),t=function(){var t,e,n,o;for(o=[],t=0,e=(n=r.split(":")).length;t<e;t++)i=n[t],o.push(parseInt(i,16));return o}(),{parts:t,zoneId:a}},t.IPv6.parser=function(t){var e,n,i,s,a,d,p;if(o.native.test(t))return r(t,8);if((s=t.match(o.transitional))&&(p=s[6]||"",(e=r(s[1].slice(0,-1)+p,6)).parts)){for(n=0,i=(d=[parseInt(s[2]),parseInt(s[3]),parseInt(s[4]),parseInt(s[5])]).length;n<i;n++)if(!(0<=(a=d[n])&&a<=255))return null;return e.parts.push(d[0]<<8|d[1]),e.parts.push(d[2]<<8|d[3]),{parts:e.parts,zoneId:e.zoneId}}return null},t.IPv4.isIPv4=t.IPv6.isIPv6=function(r){return null!==this.parser(r)},t.IPv4.isValid=function(r){try{return new this(this.parser(r)),!0}catch(r){return r,!1}},t.IPv4.isValidFourPartDecimal=function(r){return!(!t.IPv4.isValid(r)||!r.match(/^\d+(\.\d+){3}$/))},t.IPv6.isValid=function(r){var t;if("string"==typeof r&&-1===r.indexOf(":"))return!1;try{return t=this.parser(r),new this(t.parts,t.zoneId),!0}catch(r){return r,!1}},t.IPv4.parse=function(r){var t;if(null===(t=this.parser(r)))throw new Error("ipaddr: string is not formatted like ip address");return new this(t)},t.IPv6.parse=function(r){var t;if(null===(t=this.parser(r)).parts)throw new Error("ipaddr: string is not formatted like ip address");return new this(t.parts,t.zoneId)},t.IPv4.parseCIDR=function(r){var t,e;if((e=r.match(/^(.+)\/(\d+)$/))&&(t=parseInt(e[2]))>=0&&t<=32)return[this.parse(e[1]),t];throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},t.IPv4.subnetMaskFromPrefixLength=function(r){var t,e,n;if((r=parseInt(r))<0||r>32)throw new Error("ipaddr: invalid IPv4 prefix length");for(n=[0,0,0,0],e=0,t=Math.floor(r/8);e<t;)n[e]=255,e++;return t<4&&(n[t]=Math.pow(2,r%8)-1<<8-r%8),new this(n)},t.IPv4.broadcastAddressFromCIDR=function(r){var t,e,n,i,o;try{for(n=(t=this.parseCIDR(r))[0].toByteArray(),o=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],e=0;e<4;)i.push(parseInt(n[e],10)|255^parseInt(o[e],10)),e++;return new this(i)}catch(r){throw r,new Error("ipaddr: the address does not have IPv4 CIDR format")}},t.IPv4.networkAddressFromCIDR=function(r){var t,e,n,i,o;try{for(n=(t=this.parseCIDR(r))[0].toByteArray(),o=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],e=0;e<4;)i.push(parseInt(n[e],10)&parseInt(o[e],10)),e++;return new this(i)}catch(r){throw r,new Error("ipaddr: the address does not have IPv4 CIDR format")}},t.IPv4.lastAddressFromCIDR=function(r){var t;try{return t=this.broadcastAddressFromCIDR(r).toByteArray(),t[3]-=1,new this(t)}catch(r){throw r,new Error("ipaddr: the address does not have IPv4 CIDR format")}},t.IPv4.firstAddressFromCIDR=function(r){var t;try{return t=this.networkAddressFromCIDR(r).toByteArray(),t[3]+=1,new this(t)}catch(r){throw r,new Error("ipaddr: the address does not have IPv4 CIDR format")}},t.IPv6.parseCIDR=function(r){var t,e;if((e=r.match(/^(.+)\/(\d+)$/))&&(t=parseInt(e[2]))>=0&&t<=128)return[this.parse(e[1]),t];throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},t.IPv6.subnetMaskFromPrefixLength=function(r){var t,e,n;if((r=parseInt(r))<0||r>128)throw new Error("ipaddr: invalid IPv6 prefix length");for(n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0,t=Math.floor(r/8);e<t;)n[e]=255,e++;return t<16&&(n[t]=Math.pow(2,r%8)-1<<8-r%8),new this(n)},t.IPv6.broadcastAddressFromCIDR=function(r){throw new Error("ipaddr: IPv6 subnets do not have broadcast addresses")},t.IPv6.networkAddressFromCIDR=function(r){throw new Error("ipaddr: IPv6 subnets do not have network addresses")},t.IPv6.lastAddressFromCIDR=function(r){var t,e,n,i,o,s;try{for(i=(n=(t=this.parseCIDR(r))[0]).toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),o=[],e=0;e<16;)o.push(parseInt(i[e],10)|255^parseInt(s[e],10)),e++;return new this(o,n.zoneId)}catch(r){throw r,new Error("ipaddr: the address does not have IPv6 CIDR format")}},t.IPv6.firstAddressFromCIDR=function(r){var t,e,n,i,o,s;try{for(i=(n=(t=this.parseCIDR(r))[0]).toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),o=[],e=0;e<16;)o.push(parseInt(i[e],10)&parseInt(s[e],10)),e++;return new this(o,n.zoneId)}catch(r){throw r,new Error("ipaddr: the address does not have IPv6 CIDR format")}},t.isValid=function(r){return t.IPv6.isValid(r)||t.IPv4.isValid(r)},t.parse=function(r){if(t.IPv6.isValid(r))return t.IPv6.parse(r);if(t.IPv4.isValid(r))return t.IPv4.parse(r);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},t.parseCIDR=function(r){try{return t.IPv6.parseCIDR(r)}catch(e){e;try{return t.IPv4.parseCIDR(r)}catch(r){throw r,new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},t.fromByteArray=function(r){var e;if(4===(e=r.length))return new t.IPv4(r);if(16===e)return new t.IPv6(r);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},t.process=function(r){var t;return"ipv6"===(t=this.parse(r)).kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},t.processCIDR=function(r){var e,n,i;return n=this.parseCIDR(r),e=n[0],i=n[1],"ipv6"===e.kind()&&e.isIPv4MappedAddress()&&i>=96&&i<=128&&(e=e.toIPv4Address(),i-=96),e="ipv6"===e.kind()?t.IPv6.firstAddressFromCIDR(e.toString()+"/"+i):t.IPv4.networkAddressFromCIDR(e.toString()+"/"+i),[e,i]}}).call(this);